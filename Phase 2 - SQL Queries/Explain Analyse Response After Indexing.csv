"QUERY PLAN"
"Sort  (cost=104100.89..104374.11 rows=109285 width=105) (actual time=716.992..720.605 rows=1243.00 loops=1)"
"  Sort Key: category_metrics.order_month DESC, (rank() OVER w1)"
"  Sort Method: quicksort  Memory: 149kB"
"  Buffers: shared hit=6880, temp read=1158 written=1160"
"  ->  WindowAgg  (cost=86416.80..88602.48 rows=109285 width=105) (actual time=715.537..719.710 rows=1243.00 loops=1)"
"        Window: w1 AS (PARTITION BY category_metrics.order_month ORDER BY category_metrics.gross_revenue ROWS UNBOUNDED PRECEDING)"
"        Storage: Memory  Maximum Storage: 17kB"
"        Buffers: shared hit=6880, temp read=1158 written=1160"
"        ->  Sort  (cost=86416.78..86689.99 rows=109285 width=97) (actual time=715.528..719.135 rows=1243.00 loops=1)"
"              Sort Key: category_metrics.order_month, category_metrics.gross_revenue DESC"
"              Sort Method: quicksort  Memory: 136kB"
"              Buffers: shared hit=6880, temp read=1158 written=1160"
"              ->  Subquery Scan on category_metrics  (cost=69926.80..71292.86 rows=109285 width=97) (actual time=714.489..718.269 rows=1243.00 loops=1)"
"                    Buffers: shared hit=6880, temp read=1158 written=1160"
"                    ->  Sort  (cost=69926.80..70200.01 rows=109285 width=105) (actual time=714.487..718.105 rows=1243.00 loops=1)"
"                          Sort Key: category_metrics_1.order_month DESC, (rank() OVER w1)"
"                          Sort Method: quicksort  Memory: 149kB"
"                          Buffers: shared hit=6880, temp read=1158 written=1160"
"                          ->  WindowAgg  (cost=52242.70..54428.38 rows=109285 width=105) (actual time=712.563..717.091 rows=1243.00 loops=1)"
"                                Window: w1 AS (PARTITION BY category_metrics_1.order_month ORDER BY category_metrics_1.gross_revenue ROWS UNBOUNDED PRECEDING)"
"                                Storage: Memory  Maximum Storage: 17kB"
"                                Buffers: shared hit=6880, temp read=1158 written=1160"
"                                ->  Sort  (cost=52242.68..52515.89 rows=109285 width=97) (actual time=712.549..716.179 rows=1243.00 loops=1)"
"                                      Sort Key: category_metrics_1.order_month, category_metrics_1.gross_revenue DESC"
"                                      Sort Method: quicksort  Memory: 136kB"
"                                      Buffers: shared hit=6880, temp read=1158 written=1160"
"                                      ->  Subquery Scan on category_metrics_1  (cost=20838.51..37118.76 rows=109285 width=97) (actual time=569.618..714.702 rows=1243.00 loops=1)"
"                                            Buffers: shared hit=6880, temp read=1158 written=1160"
"                                            ->  GroupAggregate  (cost=20838.51..37118.76 rows=109285 width=97) (actual time=569.616..714.474 rows=1243.00 loops=1)"
"                                                  Group Key: pc.product_category_name_english, (date_trunc('month'::text, o.order_purchase_timestamp))"
"                                                  Buffers: shared hit=6880, temp read=1158 written=1160"
"                                                  ->  Gather Merge  (cost=20838.51..33293.79 rows=109285 width=74) (actual time=569.492..657.604 rows=108928.00 loops=1)"
"                                                        Workers Planned: 1"
"                                                        Workers Launched: 1"
"                                                        Buffers: shared hit=6880, temp read=1158 written=1160"
"                                                        ->  Sort  (cost=19838.50..19999.22 rows=64285 width=74) (actual time=535.934..565.970 rows=54464.00 loops=2)"
"                                                              Sort Key: pc.product_category_name_english, (date_trunc('month'::text, o.order_purchase_timestamp)), o.order_id"
"                                                              Sort Method: external merge  Disk: 4696kB"
"                                                              Buffers: shared hit=6880, temp read=1158 written=1160"
"                                                              Worker 0:  Sort Method: external merge  Disk: 4568kB"
"                                                              ->  Hash Join  (cost=7748.73..11845.14 rows=64285 width=74) (actual time=119.950..227.556 rows=54464.00 loops=2)"
"                                                                    Hash Cond: (p.category_id = pc.category_id)"
"                                                                    Buffers: shared hit=6865"
"                                                                    ->  Hash Join  (cost=7746.13..11503.19 rows=64285 width=61) (actual time=119.660..204.490 rows=55246.50 loops=2)"
"                                                                          Hash Cond: ((oi.product_id)::text = (p.product_id)::text)"
"                                                                          Buffers: shared hit=6863"
"                                                                          ->  Parallel Hash Join  (cost=6564.73..10153.02 rows=64285 width=90) (actual time=102.889..158.382 rows=55246.50 loops=2)"
"                                                                                Hash Cond: ((oi.order_id)::text = (o.order_id)::text)"
"                                                                                Buffers: shared hit=5983"
"                                                                                ->  Parallel Seq Scan on order_items oi  (cost=0.00..2961.65 rows=66265 width=78) (actual time=0.010..6.420 rows=56325.00 loops=2)"
"                                                                                      Buffers: shared hit=2299"
"                                                                                ->  Parallel Hash  (cost=5855.38..5855.38 rows=56748 width=45) (actual time=102.440..103.018 rows=48357.50 loops=2)"
"                                                                                      Buckets: 131072  Batches: 1  Memory Usage: 8608kB"
"                                                                                      Buffers: shared hit=3684"
"                                                                                      ->  Parallel Hash Right Join  (cost=3249.53..5855.38 rows=56748 width=45) (actual time=36.821..79.627 rows=48357.50 loops=2)"
"                                                                                            Hash Cond: ((orv.order_id)::text = (o.order_id)::text)"
"                                                                                            Buffers: shared hit=3684"
"                                                                                            ->  Parallel Seq Scan on order_reviews orv  (cost=0.00..2453.88 rows=57888 width=37) (actual time=0.013..4.408 rows=49205.00 loops=2)"
"                                                                                                  Buffers: shared hit=1875"
"                                                                                            ->  Parallel Hash  (cost=2540.18..2540.18 rows=56748 width=41) (actual time=36.331..36.331 rows=48239.00 loops=2)"
"                                                                                                  Buckets: 131072  Batches: 1  Memory Usage: 8608kB"
"                                                                                                  Buffers: shared hit=1809"
"                                                                                                  ->  Parallel Seq Scan on orders o  (cost=0.00..2540.18 rows=56748 width=41) (actual time=0.017..16.085 rows=48239.00 loops=2)"
"                                                                                                        Filter: ((order_status)::text = 'delivered'::text)"
"                                                                                                        Rows Removed by Filter: 1482"
"                                                                                                        Buffers: shared hit=1809"
"                                                                          ->  Hash  (cost=769.51..769.51 rows=32951 width=37) (actual time=16.583..16.583 rows=32951.00 loops=2)"
"                                                                                Buckets: 65536  Batches: 1  Memory Usage: 2825kB"
"                                                                                Buffers: shared hit=880"
"                                                                                ->  Seq Scan on products p  (cost=0.00..769.51 rows=32951 width=37) (actual time=0.201..6.783 rows=32951.00 loops=2)"
"                                                                                      Buffers: shared hit=880"
"                                                                    ->  Hash  (cost=1.71..1.71 rows=71 width=21) (actual time=0.276..0.277 rows=71.00 loops=2)"
"                                                                          Buckets: 1024  Batches: 1  Memory Usage: 12kB"
"                                                                          Buffers: shared hit=2"
"                                                                          ->  Seq Scan on product_categories pc  (cost=0.00..1.71 rows=71 width=21) (actual time=0.233..0.246 rows=71.00 loops=2)"
"                                                                                Buffers: shared hit=2"
"Planning:"
"  Buffers: shared hit=120 read=17"
"Planning Time: 9.152 ms"
"Execution Time: 723.594 ms"
